<div class="container-lg">
  <dx-data-grid
    id="dataGrid"
    (onCellClick)="onCellClick($event)"
    [dataSource]="agrupadoresList"
    width="80%"
    height="400px"
    [showBorders]="true"
    [showRowLines]="true"
    [rowAlternationEnabled]="true"
  >
    <dxo-toolbar class="toolbar" id="toolbar">
      <dxi-item location="before">
        <div id="itemTitulo">AGRUPADORES</div>
      </dxi-item>
      <dxi-item location="center">
        <input
          class="input-text"
          type="number"
          placeholder="Matrícula"
          id="matricula"
        />
      </dxi-item>
      <dxi-item location="center">
        <input
          class="input-text"
          type="text"
          placeholder="Avaliador"
          id="nome"
        />
      </dxi-item>
      <dxi-item location="center">
        <input class="input-text" type="date" id="data" />
      </dxi-item>
      <dxi-item location="center">
        <input
          class="input-text"
          type="text"
          placeholder="Áreas Comuns"
          id="area"
        />
      </dxi-item>
    </dxo-toolbar>

    <dxi-column alignment="center" dataField="nomeAgrup" caption="Agrupadores">
      <ng-template dxTemplate="cellTemplate" let-data="data">
        <span class="cursor-pointer">{{ data.nomeAgrup }}</span>
      </ng-template>
    </dxi-column>

    <dxi-column
      alignment="center"
      dataField=""
      caption="Itens"
      [cellTemplate]="itensTemplate"
    >
    </dxi-column>

    <ng-template #itensTemplate let-data="data">
      <span>{{ data.itens?.length ? data.itens.join(", ") : "-" }}</span>
    </ng-template>

    <dxo-scrolling mode="virtual"></dxo-scrolling>
  </dx-data-grid>

  <!-- Drawer Agrupadores -->
  <div class="drawer" [class.open]="drawerAberto">
    <div class="drawer-header">
      <h3>Detalhes do Agrupador</h3>
      <div class="drawer-actions">
        <button class="btn-icon" (click)="abrirPopupEditar()" title="Editar nome">
          <i class="fas fa-edit"></i>
        </button>
        <button class="header-btn-cancelar" (click)="drawerAberto = false">X</button>
      </div>
    </div>

    <div class="drawer-top">
      <div class="drawer-body no-scroll">
        <!-- Edição do nome -->
        <div class="agrupador-header">
          <div class="agrupador-nome">
            <h2 *ngIf="selectedAgrupador">{{ selectedAgrupador.nomeAgrup }}</h2>
          </div>
        </div>
      </div>

      <div class="drawer-tabs sticky-tabs">
        <button
          class="drawer-tab"
          [class.active]="abaSelecionada === 'descricao'"
          (click)="abaSelecionada = 'descricao'"
        >
          Descrição
        </button>
        <button
          class="drawer-tab"
          [class.active]="abaSelecionada === 'itens'"
          (click)="abaSelecionada = 'itens'"
        >
          Itens Verificados
        </button>
      </div>
    </div>

    <!-- Conteúdo da aba Descrição -->
    <div class="drawer-body" *ngIf="abaSelecionada === 'descricao'">
      <textarea
        id="descricaoAgrupador"
        placeholder="Digite algo..."
        rows="4"
      ></textarea>
    </div>

    <!-- Conteúdo da aba Itens -->
    <div class="drawer-body" *ngIf="abaSelecionada === 'itens'">
      <div class="cadastro-itens">
        <!-- Input para nova pergunta -->
        <input type="text" placeholder="Novo item" [(ngModel)]="novoItem" />
        <button class="btn-add" (click)="adicionarItem()">Adicionar</button>
      </div>

      <div class="lista-itens">
        <h4>Itens Verificados:</h4>
        <!-- Lista de itens -->
        <ul *ngIf="selectedAgrupador">
          <li *ngFor="let item of selectedAgrupador.itens || []; let i = index">
            {{ item }}
            <button class="btn-trash" (click)="abrirPopupConfirmacao(i)">
              <i class="fas fa-trash-alt"></i>
            </button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Popup -->
    <dx-popup
      [(visible)]="popupExcluirVisible"
      [showTitle]="true"
      title="Confirmar Exclusão"
      [width]="400"
      [height]="200"
      [dragEnabled]="false"
      [showCloseButton]="true"
    >
      <div class="popup-content">
        <p>Tem certeza que deseja excluir este item?</p>
        <div class="popup-actions">
          <button class="btn-confirmar" (click)="confirmarExclusao()">
            Confirmar
          </button>
          <button class="btn-cancelar" (click)="fecharPopup()">Cancelar</button>
        </div>
      </div>
    </dx-popup>
  </div>

  <dx-popup
    [(visible)]="popupEditarNomeVisible"
    [showTitle]="true"
    title="Editar Nome do Agrupador"
    [width]="400"
    [height]="220"
    [dragEnabled]="false"
    [showCloseButton]="true"
  >
    <div class="popup-content">
      <label>Novo Nome:</label>
      <input type="text" [(ngModel)]="novoNomeAgrupador" />
      <div class="popup-actions">
        <button class="btn-confirmar" (click)="confirmarEdicaoNome()">
          Confirmar
        </button>
        <button class="btn-cancelar" (click)="popupEditarNomeVisible = false">
          Cancelar
        </button>
      </div>
    </div>
  </dx-popup>

  <!-- Botões Confirmar/Cancelar -->
  <div class="buttons-btn">
    <button class="btn-confirmar">Confirmar</button>
    <button class="btn-cancelar">Cancelar</button>
  </div>
</div>
