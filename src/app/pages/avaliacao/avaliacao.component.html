<div class="container-lg">
  <dx-data-grid
    id="dataGrid"
    (onCellDblClick)="onCellDblClick($event)"
    [dataSource]="setoresList"
    [rowAlternationEnabled]="true"
    [showRowLines]="true"
    [showBorders]="true"
    width="100%"
    height="100%"
  >
    <dxo-toolbar class="toolbar" id="toolbar">
      <dxi-item location="before" id="itemTitulo">
        PLANILHAS DE AVALIAÇÃO
      </dxi-item>
      <dxi-item>
        <dx-button
          icon="add"
          class="btn-criar"
          (click)="openPlanilhas()"
          [height]="35"
          [width]="35"
        ></dx-button>
      </dxi-item>
    </dxo-toolbar>

    <dxi-column alignment="center" dataField="nome" caption="Lista de Setores">
    </dxi-column>
    <ng-template #nomeTemplate let-data>
      <span class="cursor-pointer" (click)="abrirDrawerSetor(data)">
        {{ data.nome }}
      </span>
    </ng-template>
  </dx-data-grid>
</div>

<!-- Drawer -->
<div class="drawer" [class.open]="drawerAberto">
  <div class="drawer-header">
    <h3>Configuração de Planilha</h3>
    <button class="header-btn-cancelar" (click)="drawerAberto = false">
      X
    </button>
  </div>

  <div class="drawer-top">
    <!-- DATA-GRID lista de agrupadores -->
    <div class="agrupador-header">
      <dx-data-grid
        id="gridContainer"
        [rowAlternationEnabled]="true"
        [columnAutoWidth]="true"
        [dataSource]="agrupadoresList"
        width="100%"
        [showBorders]="true"
      >
        <dxi-column
          caption="Agrupadores"
          dataField="nome"
          [groupIndex]="0"
          [allowGrouping]="true"
          [allowSorting]="true"
          [width]="500"
        >
          <dxi-button
            icon="plus"
            hint="Selecionar Itens"
            [onClick]="getBotaoAdicionar()"></dxi-button>
        </dxi-column>

        <dxi-column caption="Incluir Itens" type="buttons" [width]="100">
          <dxi-button
            icon="plus"
            hint="Selecionar itens"
            [onClick]="abrirSelecaoItens('$event')"
          ></dxi-button>
        </dxi-column>

        <!-- <dxo-master-detail
          [enabled]="true"
          [template]="detailTemplate"
        ></dxo-master-detail> -->

        <ng-template #detailTemplate let-data>
          <dx-data-grid
            [dataSource]="agrupadoresSelecionados[data.data.nome] || []"
            [showBorders]="true"
            [columnAutoWidth]="true"
            [rowAlternationEnabled]="true"
            [showRowLines]="true"
            [rowDragging]="rowDraggingConfig(data.data.nome)"
          >
            <dxi-column
              dataField="descricao"
              caption="Item Selecionado"
            ></dxi-column>

            <dxi-column
              caption="Remover"
              [width]="100"
              cellTemplate="removerTemplate"
            ></dxi-column>

            <div *dxTemplate="let itemData of 'removerTemplate'">
              <dx-button
                icon="trash"
                hint="Remover item"
                (onClick)="
                  removerItemSelecionado(data.data.nome, itemData.data)
                "
              ></dx-button>
            </div>
          </dx-data-grid>
        </ng-template>

        <dxo-grouping #expand [autoExpandAll]="false"></dxo-grouping>
      </dx-data-grid>
    </div>

    <!-- Popup para selecionar itens -->
    <dx-popup
      [(visible)]="popupVisivel"
      width="50%"
      height="60%"
      [dragEnabled]="false"
      title="Selecionar Itens"
    >
      <div class="popup-wrapper" *dxTemplate="let data of 'content'">
        <div class="popup-scrollable">
          <dx-list
            [dataSource]="itensSelecionaveis"
            [selectionMode]="'multiple'"
            [(selectedItems)]="itensSelecionadosTemp"
            [showSelectionControls]="true"
          ></dx-list>
        </div>

        <div class="popup-footer">
          <button class="btn-confirmar" (click)="confirmarSelecaoItens()">
            Confirmar
          </button>
        </div>
      </div>
    </dx-popup>
  </div>

  <!-- Botão de salvar alterações -->
  <div class="drawer-footer" style="gap: 15px">
    <button class="btn-confirmar" (click)="salvarAlteracoes()">
      Salvar Alterações
    </button>

    <button class="btn-cancelar" (click)="cancelarAlteracoes()">
      Cancelar
    </button>
  </div>
</div>
